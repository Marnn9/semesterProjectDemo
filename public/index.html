<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server app</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="./script/clientEvents.mjs"></script>
    <script type="module" src="./script/admin.mjs"></script>
</head>

<body>
    <button id="toggleModeBtn" class="toggleModeBtn">&#9728;</button>
    <button id="myAccountBtn" style="display: none;">&#x1F464;</button>
    <div id="messageDisplayContainer"></div>

    <div id="loginForms">
        <form class="form" id="login">
            <h2 data-translate="titleLogin">Log in to create your character</h2> <br><br>
            <input type="text" class="input" name="Email" id="inpEmailLogin"
                data-translate-placeholder="mailPlaceholder" required>
            <input type="password" class="input" name="password" id="inpPasswordLogin"
                data-translate-placeholder="passwordPlaceholder" required>
            <button class="commitBtn" type="submit" id="loginBtn" data-translate="loginBtn">login</button> <br><br>
        </form>

        <form class="form" id="create" style="display: none;">
            <h2 data-translate="titleCreate">Create a user</h2> <br><br>
            <input type="text" class="input" name="username" id="inpUname" data-translate-placeholder="namePlaceholder"
                required>
            <input type="text" class="input" name="Email" id="inpEmail" data-translate-placeholder="mailPlaceholder"
                required>
            <input type="password" class="input" name="password" id="inpPassword"
                data-translate-placeholder="passwordPlaceholder" required>
            <button class="commitBtn" type="submit" id="createBtn" data-translate="createBtn">create user</button>
            <br><br>
        </form>

        <p id="createUtext" class="login-createText" data-translate="createUserText">Create user here</p>
        <p id="loginText" class="login-createText" style="display: none;" data-translate="toLoginText">Already have
            a user? login here</p>
    </div>

    <ul id="userList" class="adminItem"></ul>

    <form class="form" id="editUser" style="display: none;">
        <h2 data-translate="editUserTitle">Edit your user</h2> <br><br>
        <input type="text" class="input" name="username" id="inpUnameEdit" data-translate-placeholder="namePlaceholder">
        <input type="text" class="input" name="Email" id="inpEmailEdit" data-translate-placeholder="mailPlaceholder">
        <input type="password" class="input" name="password" id="inpPasswordEdit"
            data-translate-placeholder="passwordPlaceholder">
        <button class="commitBtn" type="submit" id="Update" data-translate="updateBtn">Update</button> <br><br>
    </form>

    <div id="bntContainerLoggedIn" class="btnContainer" style="display: none;">
        <button class="UserBtn" id="logOutUser" data-translate="logOutBtn">Log out</button>
        <button class="UserBtn" id="displayUsers" style="display: none;" data-translate="displayUsersBtn">Display
            Users</button>
        <button class="deleteUserBtn" id="deleteUserBtn" data-translate="deleteUserBtn">Delete user</button>
    </div>

    <div id="avatarStudioEvents" style="display: none;">
        <button id="mainBtn" class="globalBtn">&#8594;</button>
        <button id="checkBtn" class="globalBtn">&#10004;</button>

        <div id="choiceMenu">
            <img id="option2" class="thumbnail" src="./AvatarStudio/Media/head.png">
            <img id="option3" class="thumbnail" src="./AvatarStudio/Media/head.png">
            <img id="option4" class="thumbnail" src="./AvatarStudio/Media/head.png">
            <img id="option5" class="thumbnail" src="./AvatarStudio/Media/head.png">
            <img class="thumbnail" src="./AvatarStudio/Media/eyebrowRender.jpg" id="loadEyebrows2Button">
            <img class="thumbnail" src="./AvatarStudio/Media/eyebrow-1Render.jpg" id="loadEyebrowsButton">
        </div>
    </div>

    <div id="languageSelection">
        <img id="english" src="./media/england.png" alt="britishFlag">
        <img id="norwegian" src="./media/norway.png" alt="norwegianFlag">
        <img id="spanish" src="./media/spain.png" alt="spanishFlag">
    </div>

    <script type="module">
        const english = document.getElementById("english");
        const norwegian = document.getElementById("norwegian");
        const spanish = document.getElementById("spanish");

        // add to localstorage so you dont have to chooser language every time
        let language = "en";

        // Fetch translations from external JSON file
        async function fetchTranslations(lang) {
            try {
                const response = await fetch(`./Languages/${lang}.json`);
                const translations = await response.json();
                return translations;
            } catch (error) {
                console.error("Error fetching translations:", error);
                return {};
            }
        }

        async function replaceAllOccurrences(container, translations) {
            const elementsToTranslate = container.querySelectorAll("[data-translate], [data-translate-placeholder]");

            elementsToTranslate.forEach(element => {
                if (element.hasAttribute("data-translate")) {
                    const translationKey = element.getAttribute("data-translate");
                    const translation = translations[language] && translations[language][translationKey];

                    if (translation !== undefined) {
                        element.textContent = translation;
                    } else {
                        console.warn(`Translation not found for key '${translationKey}' in language '${language}'.`);
                    }
                }

                if (element.hasAttribute("data-translate-placeholder")) {
                    const translationKey = element.getAttribute("data-translate-placeholder");
                    const translation = translations[language] && translations[language][translationKey];

                    if (translation !== undefined) {
                        element.placeholder = translation;
                    } else {
                        console.warn(`Translation not found for key '${translationKey}' in language '${language}'.`);
                    }
                }
            });
        }

        function translateAll(translations) {
            const loginFormsContainer = document.getElementById("loginForms");
            const editUserForm = document.getElementById("editUser");
            const bntContainerLoggedIn = document.getElementById("bntContainerLoggedIn");

            replaceAllOccurrences(loginFormsContainer, translations);
            replaceAllOccurrences(editUserForm, translations);
            replaceAllOccurrences(bntContainerLoggedIn, translations);
        }

        async function setInitialLanguage() {
            // Set initial language based on the stored language or default to "en"
            language = localStorage.getItem("language") || "en";

            // Fetch translations for the initial language
            const translations = await fetchTranslations(language);

            // Translate all relevant containers
            translateAll(translations);
        }

        // Add click event listeners to each image
        english.addEventListener("click", () => {
            language = "en";
            localStorage.setItem("language", language);
            fetchTranslations(language).then(translations => {
                translateAll(translations);
            });
        });
        norwegian.addEventListener("click", () => {
            language = "no-nb";
            localStorage.setItem("language", language);
            fetchTranslations(language).then(translations => {
                translateAll(translations);
            });
        });
        spanish.addEventListener("click", () => {
            language = "es";
            localStorage.setItem("language", language);
            fetchTranslations(language).then(translations => {
                translateAll(translations);
            });
        });

        // Set initial language when the page is loaded
        document.addEventListener("DOMContentLoaded", setInitialLanguage);
    </script>
</body>

</html>